# 勤怠未入力通知システム

LINE WORKSのWebhook機能を活用した勤怠未入力者への自動通知システム

## 📋 プロジェクト概要

このプロジェクトは、勤怠管理システムから出力されたCSVデータをもとに、勤怠未入力者を抽出し、LINE WORKSを通じて段階的に通知を行う自動化ツールです。

### 主な機能

- **CSV自動読込**: 勤怠システムからエクスポートしたCSVファイルを読み込み
- **未入力者検出**: 出勤・退勤時刻が未入力の社員を自動抽出
- **段階的通知**: 管理者チャンネル通知 → 個別メンション → 個別トーク送信
- **社員マスタ管理**: LINE WORKSアカウントとの紐付け管理
- **通知履歴記録**: 送信履歴の自動記録と追跡

## 🎯 開発背景

### 課題
- 勤怠入力忘れが頻発し、月末締め処理が遅延
- 管理者が手動で未入力者を確認・通知する負荷が高い
- 督促のタイミングが遅れ、入力漏れが長期化

### 解決策
- Excelベースの自動化ツール（VBA）で既存業務フローに統合
- LINE WORKSを活用した即座の通知
- 段階的エスカレーションで効果的な督促

## 🏗️ システム構成

```
┌─────────────────┐
│ 勤怠管理システム │
└────────┬────────┘
         │ CSV出力
         ↓
┌─────────────────┐
│  Excel VBAツール │
│  ・CSV読込      │
│  ・データ抽出   │
│  ・社員マスタ   │
└────────┬────────┘
         │ Webhook/Bot API
         ↓
┌─────────────────┐
│  LINE WORKS     │
│  ・管理者Ch通知 │
│  ・個別トーク   │
└─────────────────┘
```

## 📁 ファイル構造

```
勤怠管理.xlsm
├─ [勤怠未入力] シート      # メインデータ表示・操作
├─ [社員マスタ] シート      # LINE WORKSアカウント紐付け
├─ [通知履歴] シート        # 送信ログ
├─ [設定] シート (非表示)   # Webhook URL等の設定値
│
├─ Module1_Setup.bas        # 初期セットアップ処理
├─ Module2_Import.bas       # CSV読込処理
├─ Module3_Notification.bas # 通知送信処理
└─ Module4_Master.bas       # 社員マスタ管理（将来実装）
```

## 🚀 セットアップ手順

### 前提条件

- Microsoft Excel（マクロ対応版）
- LINE WORKS管理者権限
- Python 3.8以上（VBAコード管理用）

### 1. LINE WORKS設定

1. LINE WORKS管理者画面にログイン
2. Botを作成
3. Webhook URLを取得
4. 管理者チャンネルにBotを追加

### 2. Excelファイル初期設定

```vba
' VBエディタで実行
Sub InitialSetup()
    ' シート構造と設定の自動生成
End Sub
```

実行後、以下を設定：
- `[設定]` シートのB1セルにWebhook URLを貼り付け

### 3. 動作確認

1. サンプルCSVで動作テスト
2. 管理者チャンネルへのテスト送信確認

## 📖 使い方

### 日常運用（毎日3分）

1. 勤怠システムからCSV出力
2. Excelファイルを開く
3. `[📥 CSV読込]` ボタンをクリック
4. `[📤 管理者通知]` ボタンをクリック

### 社員マスタの整備（初回・随時）

1. `[社員マスタ]` シートを開く
2. C列にLINE WORKSメールアドレスを入力
3. 入力済み人数がG1セルに表示される

## 🔧 VBAコード管理

### エクスポート（バックアップ）

```bash
python extract_vba_code.py
```

GUIで操作：
1. xlsmファイルを選択
2. 出力先を指定（または自動生成）
3. エクスポート実行

### インポート（復元）

```bash
python import_vba_code.py
```

## 📊 CSV形式仕様

### 入力フォーマット

```csv
社員番号,氏名,日付,曜日区分,届出内容,コメント,出勤時刻,退勤時刻
1904010,テスト１,2025/10/15,水,,出勤時刻と退勤時刻の両方が入力されていません,,
```

### 必須列

- A列: 社員番号（数値、社員マスタとの紐付けキー）
- B列: 氏名（文字列）
- C列: 日付（yyyy/mm/dd形式）
- F列: コメント（"入力されていません"で未入力判定）

## 🎯 フェーズ別実装計画

### フェーズ1: 管理者通知（✅完了）

- CSV読込機能
- 未入力者抽出ロジック
- Webhook経由での管理者チャンネル通知
- 緊急度別のカテゴリ分け（🔴緊急/🟡要注意/🟢確認）

### フェーズ2: マスタ管理（🚧進行中）

- 社員マスタシートの整備
- LINE WORKSメールアドレス入力
- マッチング機能の実装
- 入力状況の可視化

### フェーズ3: 個別通知（📅予定）

- Bot API設定
- 個別トークへのメッセージ送信
- メンション機能の実装
- エスカレーションロジック

### フェーズ4: 自動化（📅将来）

- CSV自動読込（タスクスケジューラ連携）
- 時刻ベースの自動実行
- エラー通知の自動送信
- ダッシュボード機能

## 🛡️ セキュリティ考慮事項

### 実装済み

- Webhook URLを非表示シートに格納
- 社員情報を外部サービスに送信しない（ローカル処理）
- VBAコードの暗号化（xlsm形式）

### 推奨事項

- Webhook URLの定期的な再発行
- ファイルのアクセス権限管理
- 通信ログの定期確認

## 🐛 トラブルシューティング

### VBAプロジェクトへのアクセスエラー

```
プログラミングによる Visual Basic プロジェクトへのアクセスは信頼性に欠けます
```

**解決方法:**
1. Excel > ファイル > オプション > トラストセンター
2. トラストセンターの設定 > マクロの設定
3. ☑ VBAプロジェクトオブジェクトモデルへのアクセスを信頼する

### Webhook送信エラー

**確認事項:**
- Webhook URLが正しいか
- Botがチャンネルに追加されているか
- インターネット接続が正常か

## 📚 関連ドキュメント

- [要件定義書](docs/requirements.md)
- [ユーザーストーリー](docs/user-stories.md)
- [システム設計書](docs/system-design.md)
- [API仕様書](docs/api-specification.md)
- [運用マニュアル](docs/operation-manual.md)

## 🤝 コントリビューション

このプロジェクトは社内プロジェクトですが、改善提案は歓迎します。

### 開発フロー

1. 機能追加・修正を実装
2. VBAコードをエクスポート（`extract_vba_code.py`）
3. Gitコミット
4. プルリクエスト作成

## 📝 変更履歴

### v1.0.0 (2025-10-17)
- ✨ CSV読込機能
- ✨ 管理者チャンネル通知機能
- ✨ 社員マスタシート
- ✨ 通知履歴記録

### v0.1.0 (2025-10-15)
- 🎉 プロジェクト開始
- 📝 要件定義

## 📄 ライセンス

社内利用限定

## 👤 開発者

- プロジェクトオーナー: [あなたの名前]
- 開発支援: Claude (Anthropic)

---

**最終更新日**: 2025-10-17
