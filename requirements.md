# 要件定義書

## プロジェクト情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | 勤怠未入力通知システム |
| バージョン | 1.0 |
| 作成日 | 2025-10-17 |
| 最終更新日 | 2025-10-17 |
| ステータス | 承認済み |

---

## 1. プロジェクト概要

### 1.1 背景

現状の勤怠管理において、以下の課題が発生している：

- 勤怠入力忘れが頻発し、月末締め処理が遅延
- 管理者が毎日手動で未入力者を確認し、個別に連絡する必要がある
- 督促のタイミングが遅れると、社員が過去の勤務状況を思い出せず、正確な入力が困難になる
- 未入力者リストの作成に毎日10-15分の作業時間が発生

### 1.2 目的

勤怠未入力者への通知を自動化し、以下を実現する：

1. **業務効率化**: 管理者の手動確認・通知作業を削減（目標：80%削減）
2. **入力促進**: タイムリーな通知により、勤怠入力率を向上（目標：95%以上）
3. **締め処理の円滑化**: 月末の勤怠締め処理の遅延を防止
4. **記録の保持**: 通知履歴を自動記録し、トレーサビリティを確保

### 1.3 スコープ

#### スコープ内

- 勤怠未入力者の自動検出
- LINE WORKSを通じた通知送信
- 管理者チャンネルへの一括通知
- 社員マスタ管理機能
- 通知履歴の記録
- CSV形式でのデータインポート

#### スコープ外（将来対応）

- 勤怠システムとの直接連携（API統合）
- 自動入力補完機能
- モバイルアプリ対応
- 多言語対応
- 複数拠点・部署への個別設定

### 1.4 期待効果

#### 定量効果

- 管理者の作業時間削減: 10分/日 → 2分/日（80%削減）
- 勤怠入力率の向上: 85% → 95%以上
- 月末締め処理の前倒し: 平均2日短縮

#### 定性効果

- 管理者の精神的負担軽減
- 社員の勤怠意識向上
- コンプライアンス強化

---

## 2. ステークホルダー

### 2.1 関係者一覧

| ステークホルダー | 役割 | 関心事項 |
|----------------|------|----------|
| 人事部門 | システム管理者・運用担当 | 運用の簡易性、エラー対応 |
| 部門管理者 | 通知受信者・督促実施者 | 通知内容の明確性、対応優先度 |
| 一般社員 | 通知受信者（将来） | プライバシー、通知方法 |
| 情報システム部 | 技術サポート | セキュリティ、保守性 |
| 経営層 | 承認者 | コスト、効果、リスク |

### 2.2 意思決定者

- プロジェクトオーナー: 人事部長
- 承認者: 情報システム部長、人事部長
- 運用責任者: 人事課長

---

## 3. 機能要件

### 3.1 必須機能（MoSCoW分析：Must Have）

#### F-001: CSV読込機能

**概要**: 勤怠管理システムから出力されたCSVファイルを読み込む

**詳細要件**:
- 対応形式: CSV（Shift-JIS / UTF-8）
- 必須列: 社員番号、氏名、日付、曜日、コメント、出勤時刻、退勤時刻
- ファイル選択: ダイアログによる手動選択
- エラーハンドリング: 形式エラー時は明確なエラーメッセージを表示
- データクリア: 既存データ削除の確認ダイアログ

**受入基準**:
- [ ] 指定されたCSV形式のファイルを正常に読み込める
- [ ] 読み込んだデータがシートに正確に反映される
- [ ] ファイル形式エラー時に適切なメッセージが表示される
- [ ] 既存データ上書き前に確認ダイアログが表示される

#### F-002: 未入力者抽出機能

**概要**: CSV内のコメント欄をもとに未入力者を自動判定

**詳細要件**:
- 判定条件: コメント列に「入力されていません」が含まれる
- 未入力日数計算: 対象日付から現在日までの経過日数を算出
- 社員ごとの集計: 同一社員の複数日未入力をグルーピング
- 優先度判定: 未入力日数に応じた緊急度分類

**受入基準**:
- [ ] 未入力者が正確に抽出される
- [ ] 未入力日数が正しく計算される
- [ ] 社員ごとの未入力日がリスト化される

#### F-003: 管理者チャンネル通知機能

**概要**: LINE WORKS管理者チャンネルへの一括通知

**詳細要件**:
- 通知方法: Webhook URL経由のHTTP POST
- メッセージ構成:
  - ヘッダー: 日付、対象者数、未入力件数
  - 本文: 緊急度別にカテゴリ分け（🔴緊急/🟡要注意/🟢確認）
  - 詳細: 各社員の氏名と未入力日リスト
  - フッター: 対応依頼メッセージ
- 送信確認: 送信前に対象者数を確認するダイアログ
- エラー処理: 送信失敗時のエラーメッセージとリトライ案内

**受入基準**:
- [ ] 管理者チャンネルに通知が正常に送信される
- [ ] メッセージが見やすく整形されている
- [ ] 緊急度が視覚的に区別できる
- [ ] 送信前に確認ダイアログが表示される

#### F-004: 社員マスタ管理機能

**概要**: 社員情報とLINE WORKSアカウントの紐付け管理

**詳細要件**:
- データ項目: 社員番号、氏名、LINEWORKSメールアドレス、更新日
- 自動登録: CSV読込時に未登録社員を自動追加
- 手動入力: LINEWORKSメールアドレスの手動入力フィールド
- 入力状況表示: 入力済み人数のカウント表示
- 検証機能: メールアドレス形式のバリデーション（将来実装）

**受入基準**:
- [ ] CSV読込時に新規社員が自動登録される
- [ ] LINEWORKSメールアドレスを入力できる
- [ ] 入力済み人数が正確にカウントされる

#### F-005: 通知履歴記録機能

**概要**: 送信した通知の履歴を自動記録

**詳細要件**:
- 記録項目: 送信日時、通知方法、対象者数、対象日付、結果（成功/失敗）
- 自動記録: 通知送信時に自動で履歴シートに追記
- 履歴表示: 履歴シートの表示機能
- データ保持: 過去6ヶ月分の履歴を保持（手動削除可能）

**受入基準**:
- [ ] 通知送信時に履歴が自動記録される
- [ ] 履歴データが正確に記録される
- [ ] 履歴シートを表示できる

### 3.2 重要機能（MoSCoW分析：Should Have）

#### F-006: 段階的エスカレーション機能

**概要**: 未入力日数に応じた段階的な通知強化

**詳細要件**:
- 1-2日: 🟢 管理者チャンネルに通常通知
- 3-4日: 🟡 管理者チャンネルに警告通知
- 5日以上: 🔴 管理者チャンネルに緊急通知
- 将来: 個別トーク送信への自動エスカレーション

**受入基準**:
- [ ] 未入力日数に応じて通知が分類される
- [ ] 視覚的に緊急度が区別できる

#### F-007: データ検証機能

**概要**: CSV読込時のデータ妥当性検証

**詳細要件**:
- 必須列チェック: 必要な列が存在するか検証
- データ型チェック: 日付形式、数値型の妥当性確認
- 重複チェック: 同一社員・同一日付の重複データ検出
- 警告表示: 検証エラー時の警告メッセージ

**受入基準**:
- [ ] 必須列の欠損を検出できる
- [ ] 日付形式エラーを検出できる
- [ ] 重複データを検出できる

### 3.3 オプション機能（MoSCoW分析：Could Have）

#### F-008: 個別トーク通知機能

**概要**: Bot API経由での個別社員への直接通知

**詳細要件**:
- 前提条件: Bot API設定、社員マスタ完備
- 通知内容: 本人宛てのパーソナライズされたメッセージ
- 送信タイミング: 手動トリガーまたは自動エスカレーション
- プライバシー配慮: 他者に未入力状況が見えないよう配慮

#### F-009: CSVエクスポート機能

**概要**: 通知履歴のCSVエクスポート

**詳細要件**:
- 出力形式: CSV（UTF-8 BOM付き）
- 出力項目: 全履歴データ
- ファイル名: 自動生成（日付付き）

#### F-010: ダッシュボード機能

**概要**: 未入力状況の可視化

**詳細要件**:
- グラフ表示: 未入力者数の推移
- 統計情報: 部署別・社員別の入力率
- 改善指標: 前月比の改善率

### 3.4 将来機能（MoSCoW分析：Won't Have - 現バージョンでは対象外）

- API連携による自動CSV取得
- Slackなど他チャットツールへの対応
- スマートフォンアプリからの通知確認
- AI活用による入力予測・補完

---

## 4. 非機能要件

### 4.1 パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| CSV読込速度 | 1,000件のデータを5秒以内に処理 | 実測 |
| 通知送信速度 | 1件の通知を3秒以内に送信 | 実測 |
| UI応答性 | ボタンクリックから1秒以内に反応 | 体感評価 |
| メモリ使用量 | Excel起動時の2倍以内 | タスクマネージャー |

### 4.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働時間 | 営業日の8:00-19:00（99%以上） |
| 復旧時間 | エラー発生から30分以内に手動復旧可能 |
| データバックアップ | 日次でVBAコードをGitにバックアップ |

### 4.3 セキュリティ要件

#### 4.3.1 アクセス制御

- Excelファイルの読み取り専用配布（編集は管理者のみ）
- Webhook URLの非表示シートでの管理
- VBAコードの保護（パスワード設定）

#### 4.3.2 データ保護

- 社員情報の外部送信禁止（ローカル処理のみ）
- 通信の暗号化（HTTPS必須）
- 個人情報の適切な取り扱い（社内規定準拠）

#### 4.3.3 監査・ログ

- 通知履歴の記録（送信日時、対象者、結果）
- エラーログの保持（デバッグ用）
- 操作履歴の記録（将来実装）

### 4.4 保守性要件

| 項目 | 要件 |
|------|------|
| コード可読性 | 全モジュールにコメント記載（20%以上） |
| モジュール化 | 機能別にモジュール分割 |
| バージョン管理 | GitによるVBAコード管理 |
| ドキュメント | 各機能の使い方マニュアル整備 |

### 4.5 互換性要件

| 項目 | 要件 |
|------|------|
| Excel バージョン | Excel 2016以降（Microsoft 365含む） |
| OS | Windows 10以降 |
| LINE WORKS | Developer Console v2.0以降 |

### 4.6 ユーザビリティ要件

- 初回セットアップは10分以内に完了可能
- 日常操作は3クリック以内で完結
- エラーメッセージは具体的な対処方法を含む
- ボタンは日本語+絵文字で視覚的に理解しやすく

### 4.7 拡張性要件

- 新規機能追加時にコア機能への影響を最小化
- 他チャットツールへの対応を見据えた設計
- API連携への将来的な移行を考慮

---

## 5. データ要件

### 5.1 データモデル

#### 勤怠未入力データ

| 列名 | データ型 | 必須 | 説明 | 制約 |
|------|---------|------|------|------|
| 社員番号 | 文字列 | ✓ | 社員の一意識別子 | 7桁 |
| 氏名 | 文字列 | ✓ | 社員の氏名 | 最大50文字 |
| 日付 | 日付 | ✓ | 対象日 | yyyy/mm/dd |
| 曜日 | 文字列 | - | 曜日区分 | 月/火/水/木/金/土/日 |
| コメント | 文字列 | ✓ | 未入力判定用 | - |
| 未入力日数 | 数値 | - | 経過日数 | 計算式 |
| メール有無 | 文字列 | - | マスタ登録状況 | ✓/-（計算式） |

#### 社員マスタデータ

| 列名 | データ型 | 必須 | 説明 | 制約 |
|------|---------|------|------|------|
| 社員番号 | 文字列 | ✓ | 主キー | 7桁、一意 |
| 氏名 | 文字列 | ✓ | 社員氏名 | 最大50文字 |
| LINEWORKSメール | 文字列 | - | LINE WORKSアカウント | メール形式 |
| 更新日 | 日付 | - | 最終更新日 | yyyy/mm/dd |

#### 通知履歴データ

| 列名 | データ型 | 必須 | 説明 | 制約 |
|------|---------|------|------|------|
| 送信日時 | 日時 | ✓ | 送信タイムスタンプ | yyyy/mm/dd hh:mm:ss |
| 通知方法 | 文字列 | ✓ | 通知種別 | 管理者Ch/個別トーク |
| 対象者数 | 数値 | ✓ | 通知対象人数 | 正の整数 |
| 対象日付 | 日付 | ✓ | 未入力対象日 | yyyy/mm/dd |
| 結果 | 文字列 | ✓ | 送信結果 | 成功/失敗 |

### 5.2 データボリューム

| データ種類 | 想定件数 | 増加率 |
|-----------|---------|--------|
| 社員マスタ | 200件 | +10件/年 |
| 日次未入力データ | 0-30件/日 | - |
| 通知履歴 | 250件/年 | 一定 |

### 5.3 データ保持期間

| データ種類 | 保持期間 | 削除方法 |
|-----------|---------|----------|
| 未入力データ | 当日分のみ | 次回CSV読込時に上書き |
| 社員マスタ | 永続 | 手動削除 |
| 通知履歴 | 6ヶ月 | 手動削除 |

---

## 6. 外部インターフェース要件

### 6.1 LINE WORKS Webhook API

**エンドポイント**: `https://talk.worksmobile.com/...`（ユーザー固有）

**リクエスト仕様**:
```json
{
  "content": {
    "type": "text",
    "text": "通知メッセージ本文"
  }
}
```

**レスポンス**:
- 成功: HTTP 200
- 失敗: HTTP 4xx/5xx（エラーメッセージ含む）

### 6.2 LINE WORKS Bot API（将来実装）

**認証**: OAuth 2.0
**必要な権限**: 
- `bot.message` - メッセージ送信
- `bot.read` - ユーザー情報取得

### 6.3 CSVファイル形式

**エンコーディング**: Shift-JIS または UTF-8
**区切り文字**: カンマ（,）
**改行コード**: CRLF（Windows標準）
**ヘッダー行**: 1行目に列名

---

## 7. 制約条件

### 7.1 技術的制約

- VBAの処理速度限界（大量データ処理は不向き）
- Excelファイルサイズ上限（100MB推奨）
- LINE WORKS API レート制限（600リクエスト/分）
- インターネット接続が必須

### 7.2 ビジネス制約

- 予算: 0円（既存ツールのみ使用）
- 開発期間: 1ヶ月以内
- 運用開始: 2025年11月1日
- 運用コスト: 月5時間以内の保守作業

### 7.3 組織的制約

- IT部門のサポートは週1時間まで
- 外部ベンダーへの委託不可
- 社内セキュリティポリシー準拠必須

### 7.4 法的・規制的制約

- 個人情報保護法の遵守
- 労働基準法に基づく勤怠管理要件
- 社内情報セキュリティポリシー準拠

---

## 8. 前提条件・依存関係

### 8.1 前提条件

- LINE WORKSの契約が有効
- 管理者チャンネルが作成済み
- Excel（マクロ対応版）がインストール済み
- インターネット接続環境

### 8.2 依存システム

| システム | 依存内容 | 重要度 |
|---------|---------|--------|
| 勤怠管理システム | CSV出力機能 | 高 |
| LINE WORKS | Webhook/Bot API | 高 |
| Microsoft Excel | VBA実行環境 | 高 |
| Windows OS | Excel実行基盤 | 高 |

---

## 9. リスク管理

### 9.1 技術リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| LINE WORKS API変更 | 高 | 低 | バージョン固定、変更監視 |
| Excel脆弱性 | 中 | 低 | 定期アップデート |
| VBAコード破損 | 高 | 低 | Gitバックアップ |
| Webhook URL漏洩 | 高 | 低 | 非表示シート、定期再発行 |

### 9.2 運用リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 担当者不在時の対応不可 | 高 | 中 | マニュアル整備、複数名習得 |
| CSV形式変更 | 中 | 中 | 柔軟な列マッピング機能 |
| 通知疲れ | 低 | 高 | 通知頻度の調整機能 |

### 9.3 ビジネスリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 勤怠入力率が改善しない | 中 | 低 | 定期的な効果測定、改善策検討 |
| 社員の反発 | 低 | 低 | 丁寧なコミュニケーション |

---

## 10. 受入基準

### 10.1 機能受入基準

- [ ] 全ての必須機能（F-001～F-005）が正常動作する
- [ ] 100件のテストデータで正確に処理できる
- [ ] エラーハンドリングが適切に機能する
- [ ] ユーザーマニュアルが整備されている

### 10.2 性能受入基準

- [ ] CSV読込（1,000件）が5秒以内
- [ ] 通知送信が3秒以内
- [ ] メモリ使用量が基準値以内

### 10.3 品質受入基準

- [ ] バグ密度：重大バグ0件、軽微バグ3件以内
- [ ] コードカバレッジ：主要機能80%以上
- [ ] ドキュメント完成度：100%

### 10.4 運用受入基準

- [ ] 初回セットアップが10分以内に完了
- [ ] 日常操作が3分以内に完了
- [ ] トラブルシューティングガイド整備

---

## 11. 成功基準（KPI）

### 11.1 定量指標

| KPI | 現状 | 目標 | 測定方法 |
|-----|------|------|----------|
| 勤怠入力率 | 85% | 95%以上 | 月次集計 |
| 管理者作業時間 | 10分/日 | 2分/日 | タイムトラッキング |
| 未入力検出率 | 手動 | 100%自動 | システムログ |
| 通知送信成功率 | - | 99%以上 | 通知履歴 |

### 11.2 定性指標

- 管理者の満足度：5段階評価で4以上
- 社員の受容度：アンケートで80%以上が肯定的
- システム安定性：月間ダウンタイム1時間未満

---

## 12. スケジュール

### 12.1 マイルストーン

| フェーズ | 期間 | 主要成果物 | 完了条件 |
|---------|------|-----------|----------|
| 要件定義 | 2025/10/15-17 | 要件定義書 | ✅完了 |
| フェーズ1開発 | 2025/10/18-25 | 管理者通知機能 | 動作確認完了 |
| フェーズ2開発 | 2025/10/26-11/05 | マスタ管理機能 | マスタ整備完了 |
| テスト | 2025/11/06-10 | テストレポート | 受入基準達成 |
| 本番導入 | 2025/11/11 | 運用マニュアル | 運用開始 |

### 12.2 レビューポイント

- 要件定義レビュー: 2025/10/17 ✅
- フェーズ1デモ: 2025/10/25
- フェーズ2デモ: 2025/11/05
- 本番リリース判定: 2025/11/10

---

## 13. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | [人事部長] | 2025/10/17 | |
| システム責任者 | [情報システム部長] | 2025/10/17 | |
| 運用責任者 | [人事課長] | 2025/10/17 | |

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2025/10/17 | 初版作成 | [担当者名] |

